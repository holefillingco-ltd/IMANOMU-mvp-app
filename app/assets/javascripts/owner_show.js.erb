$(function(){
  function buildTABLE(table) {
    $(`.imanomu_count${table.id}`).text(Object.keys(table['imanomus']).length);
    $(`#toriya${table.id}`).removeClass();
    $(`#toriya${table.id}`).addClass('table');
    $(`#toriya${table.id}`).addClass(`${table.vacancy_status}`);
  }
  $(function(){
    setInterval(getTablesStatus, 1000);
  });
  // 定期的に席情報を更新する関数
  function getTablesStatus(){
    $.ajax({
      url: location.href,
      type: 'GET',
      dataType: 'json'
    })
    .always(function(json){
      $.each(json, function(i, data){
        buildTABLE(data);
      });
    });
  }
  // modal挿入
  $('.table').click(function(){
    var id = $(this).attr('id');
    $('#overlay').fadeIn();
    $(`#table_status_${id}`).fadeIn();
  });
  $('#overlay').click(function(){
    var id = $(this).attr('id');
    $('#overlay').fadeOut();
    $('[id^=table]').fadeOut();
  })
});